defaults
    timeout connect         1s
    timeout client          1m
    timeout server          1m
    retries                 {{ k8s_api_ips | length }}    
    option redispatch

frontend k8s-api
    bind :::6443
    mode tcp
    option tcplog
    log 127.0.0.1 local0
    default_backend k8s-api

backend k8s-api
    mode tcp
    option tcplog
    option tcp-check
    option redispatch
    balance roundrobin
    default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100
    {% for ip in k8s_api_ips %}
        server c{{ '{:02d}'.format(loop.index) }} {{ ip }}:6443 check
    {% endfor %}
